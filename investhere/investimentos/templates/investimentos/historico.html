{% extends "investimentos/base.html" %}
{% block content %}
<style>
  :root{ --brand:#0ea5e9; --brand2:#38bdf8; --line:rgba(148,163,184,.22); --ink:#e6effa; --muted:#b6c6da; }
  .surface{
    background:
      radial-gradient(1000px 600px at 10% 15%, rgba(56,189,248,.15), transparent 60%),
      radial-gradient(800px 480px at 85% 20%, rgba(14,165,233,.12), transparent 60%),
      linear-gradient(145deg,#0b1220,#0c1a2b 55%,#0b1324);
    color:var(--ink);
  }
  .h1{font-weight:800;letter-spacing:.2px;font-size:clamp(22px,4vw,32px)}
  .muted{color:var(--muted)}
  .table{
    width:100%;border-collapse:separate;border-spacing:0 10px;
  }
  .rowg{
    background:#0f172a;border:1px solid var(--line);border-radius:12px;overflow:hidden;
  }
  .cell{padding:12px 16px}
  .badge{background:rgba(56,189,248,.14);color:#bfe9ff;border:1px solid rgba(56,189,248,.3);padding:4px 10px;border-radius:999px;font-weight:600}
  .pill{display:inline-flex;align-items:center;gap:10px;background:linear-gradient(180deg,var(--brand2),var(--brand));color:#082536;font-weight:800;border-radius:12px;padding:10px 14px;text-decoration:none}
  .pill:hover{text-decoration:none;filter:saturate(1.05)}
  .danger{background:#ef4444;color:#fff;border-radius:10px;padding:8px 12px;text-decoration:none}
  .danger:hover{opacity:.9;color:#fff}
</style>

<section class="surface py-5">
  <div class="container-xxl py-4">

    <div class="d-flex flex-wrap align-items-end justify-content-between gap-3 mb-3">
      <div>
        <h1 class="h1 mb-1">Histórico de simulações</h1>
        <div class="muted">Tudo que você calculou, separado por tipo.</div>
      </div>
      <a href="{% url 'excluir_todas_simulacoes' %}" class="danger">Excluir todo o histórico</a>
    </div>

    <!-- Investimento -->
    <h3 class="mt-4 mb-2"><span class="badge">Simulação de Investimentos</span></h3>
    {% with itens=historico|dictsortreversed:"data_criacao" %}
    <div class="table">
      {% for item in itens %}
        {% if item.tipo_simulacao == "Investimento" %}
        <div class="rowg">
          <div class="cell"><strong>{{ item.data_criacao|date:"d/m/Y H:i" }}</strong></div>
          <div class="cell">Rentab.: {{ item.rentabilidade_anual }}% CDI</div>
          <div class="cell">Inicial: R$ {{ item.valor_inicial }}</div>
          <div class="cell">Futuro: <strong>R$ {{ item.valor_futuro }}</strong></div>
          <div class="cell text-end"><a class="danger" href="{% url 'excluir_simulacao' item.id %}">Excluir</a></div>
        </div>
        {% endif %}
      {% empty %}
        <div class="muted">Nenhuma simulação ainda.</div>
      {% endfor %}
    </div>
    {% endwith %}

    <!-- Tempo até a meta -->
    <h3 class="mt-5 mb-2"><span class="badge">Cálculo do Tempo de Acumulação</span></h3>
    {% with itens=historico|dictsortreversed:"data_criacao" %}
    <div class="table">
      {% for item in itens %}
        {% if item.tipo_simulacao == "Investimento Necessário" %}
        <div class="rowg">
          <div class="cell"><strong>{{ item.data_criacao|date:"d/m/Y H:i" }}</strong></div>
          <div class="cell">Rentab.: {{ item.rentabilidade_anual }}% CDI</div>
          <div class="cell">Meta: R$ {{ item.valor_desejado }}</div>
          <div class="cell">Aporte: R$ {{ item.valor_maximo }}</div>
          <div class="cell">Tempo: <strong>{{ item.tempo_necessario }} meses</strong></div>
          <div class="cell text-end"><a class="danger" href="{% url 'excluir_simulacao' item.id %}">Excluir</a></div>
        </div>
        {% endif %}
      {% empty %}
        <div class="muted">Nenhum cálculo ainda.</div>
      {% endfor %}
    </div>
    {% endwith %}

    <div class="mt-4 d-flex gap-3">
      <a class="pill" href="{% url 'menu_principal' %}">Voltar</a>
    </div>
  </div>
</section>
{% endblock %}
